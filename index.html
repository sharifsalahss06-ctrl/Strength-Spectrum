import React, { useState, useMemo, useEffect, useCallback } from 'react';

// API/Network Code REMOVED to ensure maximum stability and reliability.

// --- STRENGTH DATA (6 Elements) ---
const STRENGTH_ELEMENTS = [
    { name: "Execution", label: "Speed & Action", key: 'fire', colorClass: "text-red-400", hex: '#F87171' },
    { name: "Relational", label: "Empathy & Influence", key: 'water', colorClass: "text-blue-400", hex: '#60A5FA' },
    { name: "Analytical", label: "Stability & Logic", key: 'earth', colorClass: "text-yellow-400", hex: '#FBBF24' },
    { name: "Creative", label: "Vision & Ideation", key: 'air', colorClass: "text-teal-400", hex: '#2DD4BF' },
    { name: "Adaptability", label: "Agility & Learning", key: 'agile', colorClass: "text-purple-400", hex: '#C084FC' },
    { name: "Leadership", label: "Vision & Direction", key: 'lead', colorClass: "text-pink-400", hex: '#F472B6' },
];

// Initial state for all 6 keys
const initialEssence = { fire: 50, water: 50, earth: 50, air: 50, agile: 50, lead: 50 }; 
const TARGET_PROFILE_KEY = 'alchemistTargetProfile';

// --- IMPROVEMENT STRATEGY DATA (6 Elements) ---
const STRATEGY_DATA = {
    fire: [
        { title: "Define Micro-Milestones", description: "Break large projects into tasks no longer than 4 hours. Focus on completing 3 micro-milestones daily to build momentum." },
        { title: "Use Timeboxing", description: "Dedicate 45 minutes of hyper-focused work followed by a 15-minute break. This disciplines your speed and prevents burnout." },
        { title: "Implement 'Done' Criteria", description: "Establish a clear definition of 'done' before starting a task to prevent rushed, incomplete execution." },
    ],
    water: [
        { title: "Active Listening Practice", description: "During meetings, dedicate 70% of your energy to listening and 30% to talking. Summarize the speaker's point before responding." },
        { title: "Scheduled Check-ins", description: "Schedule non-task-related 10-minute check-ins with team members to build trust and emotional intelligence." },
        { title: "Empathy Mapping", description: "Before making a decision, visualize how it will affect the person most impacted by the change." },
    ],
    earth: [
        { title: "Challenge Assumptions", description: "For every project, list the three largest assumptions being made. Find one piece of data to test each one." },
        { title: "Adopt the '5 Whys' Rule", description: "When a problem arises, ask 'Why?' five times in succession to get to the root cause, not just the symptom." },
        { title: "Structured Decision Matrix", description: "Use a simple pros/cons list or a weighted matrix before making medium-to-high stake decisions to minimize risk." },
    ],
    air: [
        { title: "The 'Bad Idea' Session", description: "Schedule ten minutes to brainstorm only the worst, most ridiculous ideas possible. This clears mental blocks and often leads to unexpected breakthroughs." },
        { title: "Seek External Input", description: "Spend time researching solutions in completely unrelated industries (e.g., using a medical solution for a tech problem) to force novel thinking." },
        { title: "Visualization & Prototyping", description: "Do not rely on written ideas. Quickly sketch, draw, or build a physical mockup of your vision to solidify the concept." },
    ],
    agile: [
        { title: "Cross-Training Day", description: "Spend 2 hours learning a tool or skill completely outside your primary job function once a month to increase versatility." },
        { title: "Scenario Planning", description: "For every major task, plan a 'What if X fails?' contingency. Practicing pivots improves agility under pressure." },
        { title: "Embrace Failure Audits", description: "When a project fails, analyze the failure immediately to extract lessons, rather than dwelling on the mistake." },
    ],
    lead: [
        { title: "The 15-Minute Vision Share", description: "Dedicate a small portion of team meetings to reiterate the 'Why' (the long-term vision) to maintain team focus and direction." },
        { title: "Mentorship Swap", description: "Formally mentor a junior colleague while simultaneously seeking mentorship from a senior colleague outside your department." },
        { title: "Decisive Constraint Setting", description: "Practice setting clear, non-negotiable boundaries or objectives in a task to guide team effort and reduce scope creep." },
    ],
};

// --- CORE LOGIC: Alchemy Mixer ---
const analyzeEssence = (essences) => {
    // Note: The logic now maps and sorts all 6 keys
    const sorted = STRENGTH_ELEMENTS.map(e => ({ ...e, score: essences[e.key] })).sort((a, b) => b.score - a.score);
    const dominant = sorted[0];
    const weakest = sorted[5]; // The 6th element is now the weakest

    let profile = { title: "Balanced Core", summary: "You are an adaptable generalist. You are highly resilient but lack the sharp edge of a defined superpower.", color: "bg-gradient-to-r from-purple-500 to-pink-500", pulseRate: "slow" };

    if (dominant.score >= 80) {
        if (dominant.key === 'fire') {
            profile = { title: "The Volcanic Executor (Superpower: Action)", summary: `Your strength is rapid, aggressive execution. You get things done fast, but your critical flaw is 'Blind Speed' (low ${weakest.name}).`, color: "bg-gradient-to-r from-red-600 to-yellow-600", pulseRate: "fast" };
        } else if (dominant.key === 'water') {
            profile = { title: "The Harmonious Nexus (Superpower: Empathy)", summary: `Your strength is profound influence and team harmony. Your critical flaw is 'Paralysis by Consensus' (low ${weakest.name}).`, color: "bg-gradient-to-r from-blue-600 to-cyan-400", pulseRate: "medium" };
        } else if (dominant.key === 'earth') {
            profile = { title: "The Foundation Architect (Superpower: Logic)", summary: `Your strength is impeccable structure and reliability. Your critical flaw is 'Rigid Thinking' (low ${weakest.name}), making quick pivots impossible.`, color: "bg-gradient-to-r from-yellow-800 to-green-700", pulseRate: "slow" };
        } else if (dominant.key === 'air') {
            profile = { title: "The Limitless Visionary (Superpower: Creativity)", summary: `Your strength is defining the future and endless ideation. Your critical flaw is 'Groundless Dreams' (low ${weakest.name}), struggling with implementation.`, color: "bg-gradient-to-r from-teal-500 to-indigo-600", pulseRate: "fast" };
        } else if (dominant.key === 'agile') {
            profile = { title: "The Adaptive Pioneer (Superpower: Agility)", summary: `Your strength is your ability to pivot and learn quickly. Your critical flaw is 'Lack of Deep Roots' (low ${weakest.name}), risking burnout or inconsistency.`, color: "bg-gradient-to-r from-purple-600 to-pink-600", pulseRate: "medium" };
        } else if (dominant.key === 'lead') {
            profile = { title: "The Strategic Commander (Superpower: Direction)", summary: `Your strength is setting clear vision and inspiring teams. Your critical flaw is 'Delegation Overload' (low ${weakest.name}), risking micromanagement.`, color: "bg-gradient-to-r from-pink-700 to-red-500", pulseRate: "medium" };
        }
    }

    return { ...profile, dominant: dominant, weakest: weakest, currentEssences: essences };
};

// --- AURA VISUALIZATION COMPONENT ---
const AuraDisplay = ({ analysis }) => {
    const gradientStyle = {
        '--aura-color-1': analysis.dominant.hex || '#6B7280', 
        '--aura-color-2': analysis.weakest.hex || '#6B7280',
    };

    return (
        <div className={`flex items-center justify-center p-6 mb-6 rounded-full aspect-square relative ${analysis.pulseRate === 'fast' ? 'animate-pulse-fast' : analysis.pulseRate === 'medium' ? 'animate-pulse-medium' : analysis.pulseRate === 'slow'}`} style={gradientStyle}>
            
            {/* Inner Essence Core */}
            <div className={`w-32 h-32 rounded-full shadow-2xl ${analysis.color} flex items-center justify-center`}>
                <span className="text-4xl font-extrabold text-white">{analysis.dominant.name.charAt(0)}</span>
            </div>
            
            {/* Outer Aura (Pulsating Gradient) */}
            <style jsx="true">{`
                .aura-effect::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    border-radius: 50%;
                    padding: 15px;
                    background: radial-gradient(circle, var(--aura-color-1) 10%, transparent 60%);
                    opacity: 0.6;
                    z-index: -1;
                    animation: aura-expand 4s infinite alternate ease-in-out;
                }
                @keyframes aura-expand {
                    from { transform: scale(1.0); opacity: 0.4; }
                    to { transform: scale(1.2); opacity: 0.8; }
                }
                
                /* Pulse rate for the main container */
                @keyframes pulse-fast { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
                @keyframes pulse-medium { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
                @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.9; } }
            `}</style>
            
            <div className="aura-effect absolute w-full h-full rounded-full"></div>
        </div>
    );
};


const EssenceSlider = ({ element, value, onChange }) => (
    <div className="mb-4 p-3 rounded-xl shadow-inner bg-gray-800 border border-gray-700 transition-shadow hover:shadow-lg">
        <label className={`block text-lg font-semibold ${element.colorClass} mb-2`}>
            {element.name} ({element.label}): <span className="float-right font-mono text-xl">{value}</span>
        </label>
        <input
            type="range"
            min="0"
            max={100}
            value={value}
            onChange={(e) => onChange(element.key, parseInt(e.target.value))}
            className="w-full h-2 rounded-lg appearance-none cursor-pointer"
            style={{
                '--range-color': element.hex
            }}
        />
        <style jsx="true">{`
            input[type=range] {
                height: 0.5rem;
                background: #4B5563;
                border-radius: 9999px;
            }
            input[type=range]::-webkit-slider-thumb {
                appearance: none;
                width: 18px; /* Slightly larger thumb for better interaction */
                height: 18px;
                border-radius: 50%;
                cursor: pointer;
                background: var(--range-color);
                border: 2px solid #1F2937;
                box-shadow: 0 0 5px rgba(0,0,0,0.5);
                transition: transform 0.1s;
            }
            input[type=range]::-webkit-slider-thumb:active {
                transform: scale(1.2); /* Fun feedback when dragging */
            }
        `}</style>
    </div>
);

// --- IMPROVEMENT ADVICE CARD ---
const ImprovementAdviceCard = ({ analysis }) => {
    const weakestKey = analysis.weakest.key;
    
    if (analysis.title === "Balanced Core") {
        return (
            <div className="mt-6 p-4 bg-gray-700 rounded-xl border border-yellow-500">
                <h3 className="text-xl font-bold text-yellow-400 mb-2">Development Focus</h3>
                <p className="text-gray-300">
                    Your profile is balanced. To activate a superpower, try increasing one core strength (e.g., Execution) above 80 points.
                </p>
            </div>
        );
    }
    
    const strategies = STRATEGY_DATA[weakestKey] || [];

    return (
        <div className="mt-6 p-5 bg-gray-700 rounded-xl border border-red-500 shadow-2xl">
            <h3 className="text-2xl font-bold text-red-400 mb-4">
                Growth Strategies: Mastering Your Flaw ({analysis.weakest.name})
            </h3>
            <ul className="space-y-4">
                {strategies.map((s, index) => (
                    <li key={index} className="flex items-start">
                        <span className="text-2xl font-extrabold text-teal-400 mr-3">
                            {index + 1}.
                        </span>
                        <div>
                            <p className="font-semibold text-white">{s.title}</p>
                            <p className="text-sm text-gray-300">{s.description}</p>
                        </div>
                    </li>
                ))}
            </ul>
        </div>
    );
};

// --- COMPARISON COMPONENT ---
const ComparisonCard = ({ currentEssences, savedProfile, setEssences }) => {
    if (!savedProfile) {
        return (
            <div className="p-4 bg-gray-700 rounded-xl mt-4 text-center border-dashed border-2 border-gray-600">
                <p className="text-sm text-yellow-400 mb-2">Define your Target Profile below to activate comparison.</p>
                <button 
                    onClick={() => setEssences(initialEssence)}
                    className="text-xs text-gray-400 hover:text-white transition duration-150"
                >
                    Reset Mix
                </button>
            </div>
        );
    }
    
    return (
        <div className="p-4 bg-gray-700 rounded-xl mt-4 border border-teal-500">
            <h4 className="text-lg font-bold text-teal-400 mb-3">Target Profile: {savedProfile.title}</h4>
            {STRENGTH_ELEMENTS.map(element => {
                const currentScore = currentEssences[element.key];
                const targetScore = savedProfile.currentEssences[element.key];
                const difference = currentScore - targetScore;
                const status = difference > 5 ? 'Over-invested' : difference < -5 ? 'Under-invested' : 'Aligned';
                
                const textColor = status === 'Over-invested' ? 'text-red-400' : status === 'Under-invested' ? 'text-yellow-400' : 'text-green-400';
                
                return (
                    <div key={element.key} className="flex justify-between text-sm py-1 border-b border-gray-600 last:border-b-0">
                        <span className="font-semibold">{element.name}:</span>
                        <span className={textColor}>
                            {status} ({targetScore} vs {currentScore})
                        </span>
                    </div>
                );
            })}
        </div>
    );
};

// --- REMOVED GEMINI-POWERED CAREER ALIGNMENT CHECKER ---
const CareerAlignmentChecker = () => {
    // Placeholder component replaces the complex Gemini API call for stability
    return (
        <div className="w-full mt-8 p-5 bg-gray-700 rounded-xl shadow-2xl border border-gray-500">
            <h3 className="text-2xl font-bold text-gray-400 mb-4 border-b border-gray-800 pb-2">
                3. Career Alignment (Analysis Removed)
            </h3>
            <p className="text-sm text-gray-400">
                This feature requires external network access which is currently disabled for stability. Use the **Target Gap Analysis** above to manually define and compare job requirements.
            </p>
        </div>
    );
};


const App = () => {
    const [essences, setEssences] = useState(initialEssence);
    const [savedProfile, setSavedProfile] = useState(null);
    const [message, setMessage] = useState('');

    const handleEssenceChange = useCallback((key, value) => {
        setEssences(prev => ({ ...prev, [key]: value }));
    }, []);

    const analysis = useMemo(() => analyzeEssence(essences), [essences]);

    // Load saved profile on initial render
    useEffect(() => {
        const saved = localStorage.getItem(TARGET_PROFILE_KEY);
        if (saved) {
            try {
                setSavedProfile(JSON.parse(saved));
            } catch (e) {
                console.error("Failed to parse saved profile:", e);
                localStorage.removeItem(TARGET_PROFILE_KEY);
            }
        }
    }, []);

    // Function to save the current profile as the Target
    const saveProfile = () => {
        const profileToSave = {
            title: analysis.title,
            currentEssences: analysis.currentEssences,
        };
        localStorage.setItem(TARGET_PROFILE_KEY, JSON.stringify(profileToSave));
        setSavedProfile(profileToSave);
        setMessage("Target Profile saved successfully!");
        setTimeout(() => setMessage(''), 3000);
    };

    // Function to clear the saved profile
    const clearProfile = () => {
        localStorage.removeItem(TARGET_PROFILE_KEY);
        setSavedProfile(null);
        setMessage("Target Profile cleared.");
        setTimeout(() => setMessage(''), 3000);
    };

    return (
        <div className="min-h-screen bg-gray-900 text-gray-100 flex items-center justify-center p-4 font-sans">
            <div className="max-w-4xl w-full bg-gray-800 rounded-3xl shadow-[0_0_50px_rgba(100,20,100,0.5)] p-6 md:p-10 border border-purple-800">
                <header className="text-center mb-8">
                    <h1 className="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-blue-500 mb-2">
                        The Strengths Alchemist
                    </h1>
                    <p className="text-xl text-gray-400">Mix the six professional essences to discover your hidden profile.</p>
                </header>

                <div className="grid md:grid-cols-2 gap-8">
                    
                    {/* --- Input Column (The Game) --- */}
                    <div>
                        <h2 className="text-2xl font-bold mb-4 text-purple-400 border-b border-purple-800 pb-2">
                            1. Define Your Balance
                        </h2>
                        {STRENGTH_ELEMENTS.map(element => (
                            <EssenceSlider
                                key={element.key}
                                element={element}
                                value={essences[element.key]}
                                onChange={handleEssenceChange}
                            />
                        ))}
                        
                        <div className="mt-6 flex justify-between space-x-3">
                            <button
                                onClick={saveProfile}
                                className="w-1/2 p-3 rounded-xl font-bold text-gray-900 bg-yellow-400 hover:bg-yellow-500 transition duration-200 shadow-md"
                            >
                                SAVE AS TARGET
                            </button>
                            <button
                                onClick={clearProfile}
                                className="w-1/2 p-3 rounded-xl font-bold text-white bg-red-600 hover:bg-red-700 transition duration-200 shadow-md"
                            >
                                CLEAR TARGET
                            </button>
                        </div>
                        {message && (
                            <div className="mt-3 text-center text-sm font-semibold text-green-400 animate-fadeIn">{message}</div>
                        )}
                        
                        {/* 3. Placeholder for Career Alignment Check */}
                        <CareerAlignmentChecker />
                    </div>
                    
                    {/* --- Output Column (The Spectacle & Comparison) --- */}
                    <div className="flex flex-col items-center">
                        <h2 className="text-2xl font-bold mb-4 text-purple-400 border-b border-purple-800 pb-2 w-full text-center">
                            Essence Aura & Profile
                        </h2>
                        
                        <AuraDisplay analysis={analysis} />
                        
                        <div className={`w-full p-4 rounded-xl shadow-xl transition-all duration-500 ${analysis.color} text-white text-center mb-4`}>
                            <p className="text-2xl font-bold">{analysis.title}</p>
                        </div>
                        
                        {/* 2. Target Gap Analysis */}
                        <div className="w-full">
                            <h3 className="text-2xl font-bold mt-2 mb-4 text-teal-400 border-b border-teal-800 pb-2">
                                2. Target Gap Analysis
                            </h3>
                            <ComparisonCard 
                                currentEssences={essences} 
                                savedProfile={savedProfile} 
                                setEssences={setEssences}
                            />
                        </div>
                        
                         {/* 4. Improvement Advice */}
                        <div className="w-full mt-6">
                            <ImprovementAdviceCard analysis={analysis} />
                        </div>
                    </div>
                </div>
                
                <footer className="mt-8 text-center text-gray-500 text-sm border-t border-gray-700 pt-4">
                    <p>This tool defines one's unique professional profile through balancing core professional strengths (Execution, Empathy, Logic, Creativity).</p>
                </footer>
            </div>
        </div>
    );
};

export default App;
